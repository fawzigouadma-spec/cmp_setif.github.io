<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة التحكم - CMP SETIF</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
   
    <style>
        body { font-family: 'Cairo', sans-serif; background: #f0f2f5; margin: 0; padding: 20px; direction: rtl; }
        .login-box { max-width: 400px; margin: 100px auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); text-align: center; }
        .admin-container { display: none; max-width: 1200px; margin: auto; }
       
        h1 { color: #004aad; text-align: center; }
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.05); margin-top: 20px; }
        th, td { padding: 12px 15px; text-align: right; border-bottom: 1px solid #eee; font-size: 14px; }
        th { background: #004aad; color: white; }
       
        .status-badge { padding: 4px 10px; border-radius: 20px; font-size: 12px; color: white; font-weight: bold; }
        .new { background: #dc3545; }
        .process { background: #ffc107; color: black; }
        .done { background: #198754; }

        input[type="password"] { width: 80%; padding: 10px; margin: 10px 0; border-radius: 8px; border: 1px solid #ddd; }
        .btn { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-family: 'Cairo'; font-weight: bold; transition: 0.3s; }
        .btn-login { background: #004aad; color: white; width: 85%; }
        .btn-action { font-size: 11px; margin-left: 5px; }
        .btn-p { background: #ffc107; }
        .btn-d { background: #198754; color: white; }
    </style>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>

    <div id="loginSection" class="login-box">
        <h2>دخول المسؤولين</h2>
        <p>يرجى إدخال كلمة السر لرؤية الشكاوي</p>
        <input type="password" id="adminPass" placeholder="كلمة السر">
        <button class="btn btn-login" onclick="checkPass()">دخول</button>
    </div>

    <div id="adminDashboard" class="admin-container">
        <h1>الشكاوي الواردة - اتصالات الجزائر سطيف</h1>
        <div style="overflow-x: auto;">
            <table>
                <thead>
                    <tr>
                        <th>رقم التتبع</th>
                        <th>التاريخ</th>
                        <th>المشترك</th>
                        <th>الهاتف</th>
                        <th>المركز</th>
                        <th>نوع الشكوى</th>
                        <th>الحالة</th>
                        <th>إجراءات</th>
                    </tr>
                </thead>
                <tbody id="dataTable">
                    </tbody>
            </table>
        </div>
    </div>

<script>
    // إعداد Firebase (نفس إعدادات مشروعك)
    const firebaseConfig = {
        apiKey: "AIzaSyClGKlEHeuLkzBPx6NAKamYRG7zHhAWkGg",
        authDomain: "les-cmp-setif.firebaseapp.com",
        projectId: "les-cmp-setif",
        storageBucket: "les-cmp-setif.firebasestorage.app",
        messagingSenderId: "300479385524",
        appId: "1:300479385524:web:00ab999b49670176adece1"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // كلمة السر (يمكنك تغييرها من هنا)
    function checkPass() {
        const pass = document.getElementById("adminPass").value;
        if(pass === "setif2026") { // كلمة السر الافتراضية
            document.getElementById("loginSection").style.display = "none";
            document.getElementById("adminDashboard").style.display = "block";
            loadComplaints();
        } else {
            alert("كلمة سر خاطئة!");
        }
    }

    function loadComplaints() {
        db.collection("complaints").orderBy("date", "desc").onSnapshot(snapshot => {
            let html = "";
            snapshot.forEach(doc => {
                const c = doc.data();
                const id = doc.id;
                let statusClass = c.status === "تم التصليح" ? "done" : (c.status === "جاري المعالجة" ? "process" : "new");
                const dateStr = c.date ? c.date.toDate().toLocaleDateString('ar-DZ') : "جاري الإرسال";

                html += `
                    <tr>
                        <td><strong>${c.ticketID}</strong></td>
                        <td>${dateStr}</td>
                        <td>${c.firstName} ${c.lastName}<br><small>${c.address}</small></td>
                        <td>${c.mobilePhone}</td>
                        <td>${c.techCenter}</td>
                        <td>${c.complaintType}</td>
                        <td><span class="status-badge ${statusClass}">${c.status || 'جديدة'}</span></td>
                        <td>
                            <button class="btn btn-action btn-p" onclick="updateSt('${id}', 'جاري المعالجة')">معالجة</button>
                            <button class="btn btn-action btn-d" onclick="updateSt('${id}', 'تم التصليح')">تم</button>
                        </td>
                    </tr>
                `;
            });
            document.getElementById("dataTable").innerHTML = html;
        });
    }

    function updateSt(id, newStatus) {
        db.collection("complaints").doc(id).update({ status: newStatus });
    }
</script>
</body>
</html>
